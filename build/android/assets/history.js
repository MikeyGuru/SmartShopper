function HistoryList(){function e(){for(var e=Titanium.Database.open("products.db"),t=e.execute("SELECT * FROM products GROUP BY name"),o=[];t.isValidRow();){var n=t.fieldByName("name"),d=t.fieldByName("id"),c=t.fieldByName("image"),r=Ti.UI.createTableViewRow({title:n,hasChild:!0,id:d,url:"detail.js",height:40}),s=Ti.UI.createLabel({color:"black",font:{fontFamily:"Arial",fontWeight:"normal"},text:n,left:45,ellipsize:!0});r.add(s);var l=Ti.UI.createImageView({image:c,left:2,height:40}),T=Titanium.UI.createView({left:0,bottom:0,width:"100%",height:1,touchEnabled:!1,backgroundColor:"grey"});r.add(l),r.add(T),o.push(r),t.next()}a.setData(o),i.add(a),e.close()}function t(e){if(e.rowData.url){var t=Titanium.UI.createWindow({title:e.rowData.title,id:e.rowData.id,url:e.rowData.url,backgroundColor:"white"});t.open()}}var i=Titanium.UI.createWindow({title:"History",backgroundColor:"white"});i.orientationModes=[Titanium.UI.PORTRAIT];var a=Titanium.UI.createTableView({editable:!0});a.addEventListener("click",t),a.addEventListener("longpress",function(i){var o=Titanium.Database.open("products.db");o.execute("UPDATE products SET cart=? WHERE id=?",1,i.rowData.id),o.close();var n=Ti.UI.createNotification({message:"Item added to Shopping List"});n.duration=Ti.UI.NOTIFICATION_DURATION_SHORT,n.show(),e(),a.removeEventListener("click",t),setTimeout(function(){a.addEventListener("click",t)},1e3)}),i.addEventListener("open",function(){var t,a,o,n,d;t=i.activity.actionBar,t&&(t.setTitle("History"),i.getActivity().invalidateOptionsMenu(),t.setDisplayHomeAsUp(!0),t.onHomeIconItemSelected=function(){i.close()},d=i.activity,d.onCreateOptionsMenu=function(t){a=t.menu,o=a.add({title:"Refresh",icon:"images/refresh57white.png",showAsAction:Ti.Android.SHOW_AS_ACTION_NEVER}),o.addEventListener("click",function(){e();var t=Ti.UI.createNotification({message:"Refreshed"});t.duration=Ti.UI.NOTIFICATION_DURATION_SHORT,t.show()}),n=a.add({title:"Delete All",icon:"images/delete81.png",showAsAction:Ti.Android.SHOW_AS_ACTION_NEVER}),n.addEventListener("click",function(){var t=Ti.UI.createAlertDialog({cancel:1,buttonNames:["Confirm","Cancel"],message:"Are you sure you want to delete all items?",title:"Delete All",textAlign:Ti.UI.TEXT_ALIGNMENT_CENTER});t.addEventListener("click",function(t){if(t.index===t.source.cancel&&Ti.API.info("The cancel button was clicked"),0===t.index){var i=Titanium.Database.open("products.db");i.execute("DELETE FROM products"),i.close(),Ti.API.info("The confirm button was clicked"),e();var a=Ti.UI.createNotification({message:"ALll Items Deleted"});a.duration=Ti.UI.NOTIFICATION_DURATION_LONG,a.show()}}),t.show()})}),e()}),i.addEventListener("focus",e),i.open()}exports.HistoryList=HistoryList;